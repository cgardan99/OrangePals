SET NAMES UTF8;
SET CHARACTER SET UTF8;
CREATE DATABASE ORANGEPALS;

USE ORANGEPALS;

CREATE TABLE PAIS (ID INT PRIMARY KEY AUTO_INCREMENT, NOMBRE VARCHAR(100));
INSERT INTO PAIS (NOMBRE) VALUES ('Afghanistan');
INSERT INTO PAIS (NOMBRE) VALUES ('Albania');
INSERT INTO PAIS (NOMBRE) VALUES ('Algeria');
INSERT INTO PAIS (NOMBRE) VALUES ('Andorra');
INSERT INTO PAIS (NOMBRE) VALUES ('Angola');
INSERT INTO PAIS (NOMBRE) VALUES ('Antigua and Barbuda');
INSERT INTO PAIS (NOMBRE) VALUES ('Argentina');
INSERT INTO PAIS (NOMBRE) VALUES ('Armenia');
INSERT INTO PAIS (NOMBRE) VALUES ('Australia');
INSERT INTO PAIS (NOMBRE) VALUES ('Austria');
INSERT INTO PAIS (NOMBRE) VALUES ('Azerbaijan');
INSERT INTO PAIS (NOMBRE) VALUES ('Bahamas');
INSERT INTO PAIS (NOMBRE) VALUES ('Bahrain');
INSERT INTO PAIS (NOMBRE) VALUES ('Bangladesh');
INSERT INTO PAIS (NOMBRE) VALUES ('Barbados');
INSERT INTO PAIS (NOMBRE) VALUES ('Belarus');
INSERT INTO PAIS (NOMBRE) VALUES ('Belgium');
INSERT INTO PAIS (NOMBRE) VALUES ('Belize');
INSERT INTO PAIS (NOMBRE) VALUES ('Benin');
INSERT INTO PAIS (NOMBRE) VALUES ('Bhutan');
INSERT INTO PAIS (NOMBRE) VALUES ('Bolivia');
INSERT INTO PAIS (NOMBRE) VALUES ('Bosnia and Herzegovina');
INSERT INTO PAIS (NOMBRE) VALUES ('Botswana');
INSERT INTO PAIS (NOMBRE) VALUES ('Brazil');
INSERT INTO PAIS (NOMBRE) VALUES ('Brunei');
INSERT INTO PAIS (NOMBRE) VALUES ('Bulgaria');
INSERT INTO PAIS (NOMBRE) VALUES ('Burkina Faso');
INSERT INTO PAIS (NOMBRE) VALUES ('Burundi');
INSERT INTO PAIS (NOMBRE) VALUES ("CÃ´te d'Ivoire");
INSERT INTO PAIS (NOMBRE) VALUES ('Cabo Verde');
INSERT INTO PAIS (NOMBRE) VALUES ('Cambodia');
INSERT INTO PAIS (NOMBRE) VALUES ('Cameroon');
INSERT INTO PAIS (NOMBRE) VALUES ('Canada');
INSERT INTO PAIS (NOMBRE) VALUES ('Central African Republic');
INSERT INTO PAIS (NOMBRE) VALUES ('Chad');
INSERT INTO PAIS (NOMBRE) VALUES ('Chile');
INSERT INTO PAIS (NOMBRE) VALUES ('China');
INSERT INTO PAIS (NOMBRE) VALUES ('Colombia');
INSERT INTO PAIS (NOMBRE) VALUES ('Comoros');
INSERT INTO PAIS (NOMBRE) VALUES ('Congo (Congo-Brazzaville)');
INSERT INTO PAIS (NOMBRE) VALUES ('Costa Rica');
INSERT INTO PAIS (NOMBRE) VALUES ('Croatia');
INSERT INTO PAIS (NOMBRE) VALUES ('Cuba');
INSERT INTO PAIS (NOMBRE) VALUES ('Cyprus');
INSERT INTO PAIS (NOMBRE) VALUES ('Czechia (Czech Republic)');
INSERT INTO PAIS (NOMBRE) VALUES ('Democratic Republic of the Congo');
INSERT INTO PAIS (NOMBRE) VALUES ('Denmark');
INSERT INTO PAIS (NOMBRE) VALUES ('Djibouti');
INSERT INTO PAIS (NOMBRE) VALUES ('Dominica');
INSERT INTO PAIS (NOMBRE) VALUES ('Dominican Republic');
INSERT INTO PAIS (NOMBRE) VALUES ('Ecuador');
INSERT INTO PAIS (NOMBRE) VALUES ('Egypt');
INSERT INTO PAIS (NOMBRE) VALUES ('El Salvador');
INSERT INTO PAIS (NOMBRE) VALUES ('Equatorial Guinea');
INSERT INTO PAIS (NOMBRE) VALUES ('Eritrea');
INSERT INTO PAIS (NOMBRE) VALUES ('Estonia');
INSERT INTO PAIS (NOMBRE) VALUES ('Eswatini (fmr. "Swaziland")');
INSERT INTO PAIS (NOMBRE) VALUES ('Ethiopia');
INSERT INTO PAIS (NOMBRE) VALUES ('Fiji');
INSERT INTO PAIS (NOMBRE) VALUES ('Finland');
INSERT INTO PAIS (NOMBRE) VALUES ('France');
INSERT INTO PAIS (NOMBRE) VALUES ('Gabon');
INSERT INTO PAIS (NOMBRE) VALUES ('Gambia');
INSERT INTO PAIS (NOMBRE) VALUES ('Georgia');
INSERT INTO PAIS (NOMBRE) VALUES ('Germany');
INSERT INTO PAIS (NOMBRE) VALUES ('Ghana');
INSERT INTO PAIS (NOMBRE) VALUES ('Greece');
INSERT INTO PAIS (NOMBRE) VALUES ('Grenada');
INSERT INTO PAIS (NOMBRE) VALUES ('Guatemala');
INSERT INTO PAIS (NOMBRE) VALUES ('Guinea');
INSERT INTO PAIS (NOMBRE) VALUES ('Guinea-Bissau');
INSERT INTO PAIS (NOMBRE) VALUES ('Guyana');
INSERT INTO PAIS (NOMBRE) VALUES ('Haiti');
INSERT INTO PAIS (NOMBRE) VALUES ('Holy See');
INSERT INTO PAIS (NOMBRE) VALUES ('Honduras');
INSERT INTO PAIS (NOMBRE) VALUES ('Hungary');
INSERT INTO PAIS (NOMBRE) VALUES ('Iceland');
INSERT INTO PAIS (NOMBRE) VALUES ('India');
INSERT INTO PAIS (NOMBRE) VALUES ('Indonesia');
INSERT INTO PAIS (NOMBRE) VALUES ('Iran');
INSERT INTO PAIS (NOMBRE) VALUES ('Iraq');
INSERT INTO PAIS (NOMBRE) VALUES ('Ireland');
INSERT INTO PAIS (NOMBRE) VALUES ('Israel');
INSERT INTO PAIS (NOMBRE) VALUES ('Italy');
INSERT INTO PAIS (NOMBRE) VALUES ('Jamaica');
INSERT INTO PAIS (NOMBRE) VALUES ('Japan');
INSERT INTO PAIS (NOMBRE) VALUES ('Jordan');
INSERT INTO PAIS (NOMBRE) VALUES ('Kazakhstan');
INSERT INTO PAIS (NOMBRE) VALUES ('Kenya');
INSERT INTO PAIS (NOMBRE) VALUES ('Kiribati');
INSERT INTO PAIS (NOMBRE) VALUES ('Kuwait');
INSERT INTO PAIS (NOMBRE) VALUES ('Kyrgyzstan');
INSERT INTO PAIS (NOMBRE) VALUES ('Laos');
INSERT INTO PAIS (NOMBRE) VALUES ('Latvia');
INSERT INTO PAIS (NOMBRE) VALUES ('Lebanon');
INSERT INTO PAIS (NOMBRE) VALUES ('Lesotho');
INSERT INTO PAIS (NOMBRE) VALUES ('Liberia');
INSERT INTO PAIS (NOMBRE) VALUES ('Libya');
INSERT INTO PAIS (NOMBRE) VALUES ('Liechtenstein');
INSERT INTO PAIS (NOMBRE) VALUES ('Lithuania');
INSERT INTO PAIS (NOMBRE) VALUES ('Luxembourg');
INSERT INTO PAIS (NOMBRE) VALUES ('Madagascar');
INSERT INTO PAIS (NOMBRE) VALUES ('Malawi');
INSERT INTO PAIS (NOMBRE) VALUES ('Malaysia');
INSERT INTO PAIS (NOMBRE) VALUES ('Maldives');
INSERT INTO PAIS (NOMBRE) VALUES ('Mali');
INSERT INTO PAIS (NOMBRE) VALUES ('Malta');
INSERT INTO PAIS (NOMBRE) VALUES ('Marshall Islands');
INSERT INTO PAIS (NOMBRE) VALUES ('Mauritania');
INSERT INTO PAIS (NOMBRE) VALUES ('Mauritius');
INSERT INTO PAIS (NOMBRE) VALUES ('Mexico');
INSERT INTO PAIS (NOMBRE) VALUES ('Micronesia');
INSERT INTO PAIS (NOMBRE) VALUES ('Moldova');
INSERT INTO PAIS (NOMBRE) VALUES ('Monaco');
INSERT INTO PAIS (NOMBRE) VALUES ('Mongolia');
INSERT INTO PAIS (NOMBRE) VALUES ('Montenegro');
INSERT INTO PAIS (NOMBRE) VALUES ('Morocco');
INSERT INTO PAIS (NOMBRE) VALUES ('Mozambique');
INSERT INTO PAIS (NOMBRE) VALUES ('Myanmar (formerly Burma)');
INSERT INTO PAIS (NOMBRE) VALUES ('Namibia');
INSERT INTO PAIS (NOMBRE) VALUES ('Nauru');
INSERT INTO PAIS (NOMBRE) VALUES ('Nepal');
INSERT INTO PAIS (NOMBRE) VALUES ('Netherlands');
INSERT INTO PAIS (NOMBRE) VALUES ('New Zealand');
INSERT INTO PAIS (NOMBRE) VALUES ('Nicaragua');
INSERT INTO PAIS (NOMBRE) VALUES ('Niger');
INSERT INTO PAIS (NOMBRE) VALUES ('Nigeria');
INSERT INTO PAIS (NOMBRE) VALUES ('North Korea');
INSERT INTO PAIS (NOMBRE) VALUES ('North Macedonia');
INSERT INTO PAIS (NOMBRE) VALUES ('Norway');
INSERT INTO PAIS (NOMBRE) VALUES ('Oman');
INSERT INTO PAIS (NOMBRE) VALUES ('Pakistan');
INSERT INTO PAIS (NOMBRE) VALUES ('Palau');
INSERT INTO PAIS (NOMBRE) VALUES ('Palestine State');
INSERT INTO PAIS (NOMBRE) VALUES ('Panama');
INSERT INTO PAIS (NOMBRE) VALUES ('Papua New Guinea');
INSERT INTO PAIS (NOMBRE) VALUES ('Paraguay');
INSERT INTO PAIS (NOMBRE) VALUES ('Peru');
INSERT INTO PAIS (NOMBRE) VALUES ('Philippines');
INSERT INTO PAIS (NOMBRE) VALUES ('Poland');
INSERT INTO PAIS (NOMBRE) VALUES ('Portugal');
INSERT INTO PAIS (NOMBRE) VALUES ('Qatar');
INSERT INTO PAIS (NOMBRE) VALUES ('Romania');
INSERT INTO PAIS (NOMBRE) VALUES ('Russia');
INSERT INTO PAIS (NOMBRE) VALUES ('Rwanda');
INSERT INTO PAIS (NOMBRE) VALUES ('Saint Kitts and Nevis');
INSERT INTO PAIS (NOMBRE) VALUES ('Saint Lucia');
INSERT INTO PAIS (NOMBRE) VALUES ('Saint Vincent and the Grenadines');
INSERT INTO PAIS (NOMBRE) VALUES ('Samoa');
INSERT INTO PAIS (NOMBRE) VALUES ('San Marino');
INSERT INTO PAIS (NOMBRE) VALUES ('Sao Tome and Principe');
INSERT INTO PAIS (NOMBRE) VALUES ('Saudi Arabia');
INSERT INTO PAIS (NOMBRE) VALUES ('Senegal');
INSERT INTO PAIS (NOMBRE) VALUES ('Serbia');
INSERT INTO PAIS (NOMBRE) VALUES ('Seychelles');
INSERT INTO PAIS (NOMBRE) VALUES ('Sierra Leone');
INSERT INTO PAIS (NOMBRE) VALUES ('Singapore');
INSERT INTO PAIS (NOMBRE) VALUES ('Slovakia');
INSERT INTO PAIS (NOMBRE) VALUES ('Slovenia');
INSERT INTO PAIS (NOMBRE) VALUES ('Solomon Islands');
INSERT INTO PAIS (NOMBRE) VALUES ('Somalia');
INSERT INTO PAIS (NOMBRE) VALUES ('South Africa');
INSERT INTO PAIS (NOMBRE) VALUES ('South Korea');
INSERT INTO PAIS (NOMBRE) VALUES ('South Sudan');
INSERT INTO PAIS (NOMBRE) VALUES ('Spain');
INSERT INTO PAIS (NOMBRE) VALUES ('Sri Lanka');
INSERT INTO PAIS (NOMBRE) VALUES ('Sudan');
INSERT INTO PAIS (NOMBRE) VALUES ('Suriname');
INSERT INTO PAIS (NOMBRE) VALUES ('Sweden');
INSERT INTO PAIS (NOMBRE) VALUES ('Switzerland');
INSERT INTO PAIS (NOMBRE) VALUES ('Syria');
INSERT INTO PAIS (NOMBRE) VALUES ('Tajikistan');
INSERT INTO PAIS (NOMBRE) VALUES ('Tanzania');
INSERT INTO PAIS (NOMBRE) VALUES ('Thailand');
INSERT INTO PAIS (NOMBRE) VALUES ('Timor-Leste');
INSERT INTO PAIS (NOMBRE) VALUES ('Togo');
INSERT INTO PAIS (NOMBRE) VALUES ('Tonga');
INSERT INTO PAIS (NOMBRE) VALUES ('Trinidad and Tobago');
INSERT INTO PAIS (NOMBRE) VALUES ('Tunisia');
INSERT INTO PAIS (NOMBRE) VALUES ('Turkey');
INSERT INTO PAIS (NOMBRE) VALUES ('Turkmenistan');
INSERT INTO PAIS (NOMBRE) VALUES ('Tuvalu');
INSERT INTO PAIS (NOMBRE) VALUES ('Uganda');
INSERT INTO PAIS (NOMBRE) VALUES ('Ukraine');
INSERT INTO PAIS (NOMBRE) VALUES ('United Arab Emirates');
INSERT INTO PAIS (NOMBRE) VALUES ('United Kingdom');
INSERT INTO PAIS (NOMBRE) VALUES ('United States of America');
INSERT INTO PAIS (NOMBRE) VALUES ('Uruguay');
INSERT INTO PAIS (NOMBRE) VALUES ('Uzbekistan');
INSERT INTO PAIS (NOMBRE) VALUES ('Vanuatu');
INSERT INTO PAIS (NOMBRE) VALUES ('Venezuela');
INSERT INTO PAIS (NOMBRE) VALUES ('Vietnam');
INSERT INTO PAIS (NOMBRE) VALUES ('Yemen');
INSERT INTO PAIS (NOMBRE) VALUES ('Zambia');
INSERT INTO PAIS (NOMBRE) VALUES ('Zimbabwe');
CREATE TABLE USUARIO (ID INT PRIMARY KEY AUTO_INCREMENT, USERNAME VARCHAR(45), EMAIL VARCHAR(100), PAIS TINYINT(2), PWD CHAR(128));
CREATE TABLE PUBLICACION (ID INT PRIMARY KEY AUTO_INCREMENT, TITULO VARCHAR(80), TEXTO_PUBLICACION TEXT, USUARIO_ID INT, F_PUBLICACION DATETIME, FOREIGN KEY(USUARIO_ID) REFERENCES USUARIO(ID));
CREATE TABLE TAG (ID INT PRIMARY KEY AUTO_INCREMENT, NOMBRE VARCHAR(45));
INSERT INTO TAG (NOMBRE) VALUES ('Anecdota');
INSERT INTO TAG (NOMBRE) VALUES ('Experiencias');
INSERT INTO TAG (NOMBRE) VALUES ('Relatos');
INSERT INTO TAG (NOMBRE) VALUES ('Busco Ayuda');
CREATE TABLE TAG_PUBLICACION (ID INT PRIMARY KEY AUTO_INCREMENT, PUBLICACION_ID INT, TAG_ID INT, FOREIGN KEY (PUBLICACION_ID) REFERENCES PUBLICACION(ID), FOREIGN KEY (TAG_ID) REFERENCES TAG (ID));
CREATE TABLE COMENTARIO (ID int PRIMARY KEY AUTO_INCREMENT, TEXTO TEXT, USUARIO_ID INT, PUBLICACION_ID INT, COMENTARIO_ID INT, F_PUBLICACION DATETIME, FOREIGN KEY (USUARIO_ID) REFERENCES USUARIO (ID), FOREIGN KEY (PUBLICACION_ID) REFERENCES PUBLICACION (ID), FOREIGN KEY (COMENTARIO_ID) REFERENCES COMENTARIO (ID));
CREATE TABLE CORAZON (ID INT PRIMARY KEY AUTO_INCREMENT, PUBLICACION_ID INT, COMENTARIO_ID INT, USUARIO_ID INT, FECHA DATETIME, FOREIGN KEY (PUBLICACION_ID) REFERENCES PUBLICACION (ID), FOREIGN KEY (COMENTARIO_ID) REFERENCES COMENTARIO (ID), FOREIGN KEY (USUARIO_ID) REFERENCES USUARIO(ID));
CREATE TABLE BMARK (ID INT PRIMARY KEY AUTO_INCREMENT, PUBLICACION_ID INT, USUARIO_ID INT, FOREIGN KEY (PUBLICACION_ID) REFERENCES PUBLICACION (ID), FOREIGN KEY (USUARIO_ID) REFERENCES USUARIO(ID));

SET GLOBAL LOG_BIN_TRUST_FUNCTION_CREATORS=1;

DELIMITER __

CREATE FUNCTION COUNT_CM(PUBLICACION_ID INT) RETURNS INT
BEGIN
    DECLARE Y INT DEFAULT 0;
    SET Y = (SELECT COUNT(*) FROM COMENTARIO WHERE PUBLICACION_ID = PUBLICACION_ID);
    RETURN Y;
END __

CREATE FUNCTION COUNT_COR(PUBLICACION_ID INT) RETURNS INT
BEGIN
    DECLARE Y INT DEFAULT 0;
    SET Y = (SELECT COUNT(*) FROM CORAZON WHERE PUBLICACION_ID = PUBLICACION_ID);
    RETURN Y;
END __

CREATE FUNCTION COUNT_BMARK(PUBLICACION_ID INT, USUARIO_ID INT) RETURNS INT
BEGIN
    DECLARE Y INT DEFAULT 0;
    SET Y = (SELECT COUNT(*) FROM BMARK WHERE PUBLICACION_ID = PUBLICACION_ID AND USUARIO_ID = USUARIO_ID);
    RETURN Y;
END __

CREATE PROCEDURE ARMAR_LISTA_PUBLICACIONES(IN USUARIO_ID INT)
BEGIN
    SELECT P.ID, P.TITULO, SUBSTRING(P.TEXTO_PUBLICACION, 1, 200), COUNT_COR(P.ID), COUNT_CM(P.ID), COUNT_BMARK(P.ID, USUARIO_ID) FROM PUBLICACION P;
END __

DELIMITER ;
